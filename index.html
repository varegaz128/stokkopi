<!DOCTYPE html>
<html lang="id">
  <head>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#d12a08" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>DISELL Coffee ‚Äî Manager</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/service-worker.js");
      }
    </script>

    <header>
      <div class="header-inner">
        <div>
          <h1>DISELL COFFEE ‚òï</h1>
          <p>Production & Barcode Manager</p>
        </div>
        <div class="user-info" id="user-info">
          <button id="userDisplayBtn">üë§ <span id="userDisplay"></span></button>
        </div>
      </div>
    </header>

    <main>
      <section class="form-section">
        <button id="toggleFormBtn">‚ûï Tambah Produksi</button>
        <form id="addForm" class="hidden">
          <label for="menu">Pilih Menu</label>
          <select id="menu" required>
            <option value="">-- Pilih Menu --</option>
            <option>Americanoice</option>
            <option>Butterscothseasalt</option>
            <option>Caramelsalted</option>
            <option>Chocolatte</option>
            <option>KopisusudisellKSD</option>
            <option>Matchacoconut</option>
            <option>Matchalatte</option>
            <option>Thaitea</option>
            <option>Vanillalatte</option>
          </select>

          <label for="qty">Jumlah Produksi</label>
          <input
            type="number"
            id="qty"
            placeholder="Jumlah Produksi"
            min="1"
            required
          />

          <div class="form-actions">
            <button type="submit">Tambah</button>
            <button type="button" id="cancelAdd">Batal</button>
          </div>
        </form>
      </section>

      <section class="controls">
        <div class="scan-controls">
          <button id="startScanBtn">üé¨ Mulai Scan</button>
          <div id="scanResult" class="scan-result"></div>
        </div>

        <div class="data-controls" id="dataManagementContainer">
          <button id="downloadJsonBtn">üì• Download JSON</button>

          <button id="exportUserHistoryBtn" class="secondary-btn">
            üìä Export Riwayat Per User
          </button>

          <label for="uploadJsonInput" class="upload-btn">
            ‚¨ÜÔ∏è Upload Data JSON
            <input
              type="file"
              id="uploadJsonInput"
              accept=".json"
              class="hidden"
            />
          </label>
          <button id="resetDataBtn" class="danger">‚ö†Ô∏è Reset Data</button>
        </div>
      </section>
      <section class="list-section">
        <h2>Daftar Stok Produk</h2>
        <div id="productList" class="product-list-container"></div>

        <div id="historyBtnContainer">
          <button id="showHistoryBtn" class="history-btn">
            üìú History Produk
          </button>
        </div>
      </section>

      <div id="historyPopup" class="popup-overlay hidden">
        <div class="popup-content large">
          <button id="closeHistoryBtn" class="close-btn">‚úï</button>
          <h3>üìú History Produk</h3>

          <div class="export-actions">
            <button id="exportPdfBtn">üìÑ Download PDF</button>
            <button id="exportExcelBtn">üìä Download Excel</button>
          </div>

          <div class="table-wrapper">
            <table id="historyTable">
              <thead>
                <tr>
                  <th>TGL PRODUKSI</th>
                  <th>MENU</th>
                  <th>JUMLAH</th>
                  <th>JENIS</th>
                  <th>TOTAL STOK</th>
                  <th>WAKTU INTERAKSI</th>
                  <th>USER</th>
                </tr>
              </thead>
              <tbody id="historyTableBody">
                <!-- data akan diisi lewat JS -->
              </tbody>
            </table>
          </div>

          <div class="popup-footer">
            <button id="closePopupHistory">Tutup</button>
          </div>
        </div>
      </div>

      <div id="logoutPopup" class="popup-overlay hidden">
        <div
          class="popup-content"
          style="
            max-width: 300px;
            text-align: center;
            color: #000;
            background: #fff;
          "
        >
          <p>Yakin ingin keluar?</p>
          <div class="form-actions" style="justify-content: center">
            <button id="confirmLogout" class="danger">Keluar</button>
            <button id="cancelLogout">Batal</button>
          </div>
        </div>
      </div>

      <div id="uniqueBarcodePopup" class="popup-overlay hidden">
        <div class="popup-content futuristic-popup">
          <button
            id="closeUniqueBarcodeBtn"
            class="close-btn"
            style="color: var(--neon-color)"
          >
            ‚úï
          </button>
          <h3 id="uniqueBarcodeTitle">Barcode Unik</h3>
          <div id="uniqueBarcodeContainer"></div>

          <p
            id="uniqueBarcodeCode"
            style="color: white; font-weight: 700; text-align: center"
          ></p>
          <button
            id="printUniqueBarcodeBtn"
            class="futuristic-btn success-btn hidden"
            style="width: 100%; margin-top: 15px"
          >
            üñ®Ô∏è Cetak Barcode Ini
          </button>
        </div>
      </div>
      <!-- üìä POPUP EXPORT RIWAYAT PER USER (FUTURISTIK) -->
      <div id="exportUserPopup" class="popup-overlay hidden">
        <div class="popup-content futuristic-popup" style="max-width: 400px">
          <button id="closeExportUserPopup" class="close-btn">‚úï</button>
          <h3 style="margin-bottom: 15px">üìä Export Riwayat Per User</h3>

          <p
            style="
              color: var(--neon-color);
              font-weight: 600;
              margin-bottom: 10px;
            "
          >
            Pilih user yang ingin diexport:
          </p>

          <select
            id="userSelectDropdown"
            class="futuristic-dropdown"
            style="width: 100%; padding: 10px; font-size: 1rem"
          >
            <option value="">-- Pilih User --</option>
          </select>

          <div
            class="form-actions"
            style="margin-top: 20px; justify-content: center; gap: 10px"
          >
            <button
              id="confirmExportUserBtn"
              class="futuristic-btn success-btn"
            >
              üöÄ Export Sekarang
            </button>
            <button
              id="cancelExportUserBtn"
              class="futuristic-btn secondary-btn"
            >
              Batal
            </button>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <small>DISELL Coffee ‚Ä¢ Local demo (vanilla)</small>
    </footer>
    <button onclick="showUniqueBarcode('Matchalatte', '30/10/2025')">
      üîç Lihat Barcode
    </button>

    <div id="scanPopup" class="hidden popup-overlay">
      <div class="popup-content">
        <button id="closeScanBtn" class="close-btn">‚úï</button>
        <h3>Scan Barcode</h3>
        <div
          id="cameraInfo"
          class="hidden"
          style="color: red; text-align: center; margin-top: 10px"
        >
          Kamera belum aktif. Tekan tombol di bawah untuk mulai.
        </div>

        <div id="reader" style="width: 100%; height: 300px; margin: auto"></div>
        <p id="scanResult" style="text-align: center">
          Menunggu aktivasi kamera...
        </p>
        <button id="triggerCamBtn" class="futuristic-btn">
          Mulai Kamera Sekarang
        </button>
        <button id="stopScanBtn" class="stop-btn">Berhenti</button>
      </div>
    </div>
    <!-- üì¶ POPUP BARCODE UNIK -->
    <div id="uniqueBarcodePopup" class="popup-overlay hidden">
      <div class="popup-content futuristic-popup" style="max-width: 350px">
        <button
          id="closeUniqueBarcodeBtn"
          class="close-btn"
          style="color: var(--neon-color)"
        >
          ‚úï
        </button>
        <h3 id="uniqueBarcodeTitle">Barcode Unik</h3>

        <!-- üî• TEMPAT QR BARCODE -->
        <div
          id="uniqueBarcodeContainer"
          style="margin: 20px auto; width: 250px; height: 250px"
        ></div>

        <p
          id="uniqueBarcodeCode"
          style="color: white; font-weight: 700; text-align: center"
        ></p>

        <button
          id="printUniqueBarcodeBtn"
          class="futuristic-btn success-btn hidden"
          style="width: 100%; margin-top: 15px"
        >
          üñ®Ô∏è Cetak Barcode Ini
        </button>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script src="js/html5-qrcode.min.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
