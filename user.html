<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login — DISELL Coffee</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="login-body">
    <div class="login-box">
      <h2>☕ DISELL Coffee</h2>
      <p id="formTitle">Masuk ke sistem produksi</p>

      <!-- ===== LOGIN FORM ===== -->
      <form id="loginForm">
        <input type="text" id="loginUsername" placeholder="Username" required />
        <input
          type="password"
          id="loginPassword"
          placeholder="Password"
          required
        />
        <button type="submit">Login</button>
      </form>

      <!-- ===== REGISTER FORM ===== -->
      <form id="registerForm" style="display: none">
        <input
          type="text"
          id="regUsername"
          placeholder="Username baru"
          required
        />
        <input
          type="password"
          id="regPassword"
          placeholder="Password"
          required
        />
        <select id="regRole" required>
          <option value="">Pilih Role</option>
          <option value="admin">Admin</option>
          <option value="staff">Staff</option>
          <option value="kasir">Kasir</option>
        </select>
        <button type="submit">Daftar</button>
      </form>

      <p id="toggleText">
        Belum punya akun?
        <a href="#" id="toggleLink">Daftar di sini</a>
      </p>
    </div>

    <script>
      // Ambil users dari localStorage (kalau belum ada, bikin array kosong)
      let users = JSON.parse(localStorage.getItem("users") || "[]");

      const loginForm = document.getElementById("loginForm");
      const registerForm = document.getElementById("registerForm");
      const toggleLink = document.getElementById("toggleLink");
      const toggleText = document.getElementById("toggleText");
      const formTitle = document.getElementById("formTitle");

      let isRegister = false;

      // ==== SWITCH LOGIN/REGISTER MODE ====
      toggleLink.addEventListener("click", (e) => {
        e.preventDefault();
        isRegister = !isRegister;

        if (isRegister) {
          loginForm.style.display = "none";
          registerForm.style.display = "block";
          formTitle.textContent = "Daftar Akun Baru";
          toggleText.innerHTML =
            'Sudah punya akun? <a href="#" id="toggleLink">Login di sini</a>';
        } else {
          loginForm.style.display = "block";
          registerForm.style.display = "none";
          formTitle.textContent = "Masuk ke sistem produksi";
          toggleText.innerHTML =
            'Belum punya akun? <a href="#" id="toggleLink">Daftar di sini</a>';
        }
      });

      // ==== LOGIN ====
      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const username = document
          .getElementById("loginUsername")
          .value.trim()
          .toLowerCase();
        const password = document.getElementById("loginPassword").value.trim();

        const user = users.find(
          (u) => u.username === username && u.password === password
        );

        if (user) {
          localStorage.setItem("currentUser", JSON.stringify(user));
          alert(`Selamat datang, ${user.username}!`);
          window.location.href = "index.html";
        } else {
          alert("❌ Username atau password salah!");
        }
      });

      // ==== REGISTER ====
      registerForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const username = document
          .getElementById("regUsername")
          .value.trim()
          .toLowerCase();
        const password = document.getElementById("regPassword").value.trim();
        const role = document.getElementById("regRole").value;

        if (!username || !password || !role)
          return alert("⚠️ Lengkapi semua data!");

        if (users.some((u) => u.username === username))
          return alert("⚠️ Username sudah dipakai!");

        const newUser = {
          id: Date.now(),
          username,
          password,
          role,
        };

        users.push(newUser);
        localStorage.setItem("users", JSON.stringify(users));

        alert("✅ Akun berhasil dibuat! Silakan login.");
        isRegister = false;
        loginForm.style.display = "block";
        registerForm.style.display = "none";
        formTitle.textContent = "Masuk ke sistem produksi";
        toggleText.innerHTML =
          'Belum punya akun? <a href="#" id="toggleLink">Daftar di sini</a>';
      });

      // ==== AUTO CREATE ADMIN DEFAULT ====
      if (users.length === 0) {
        users.push({
          id: 1,
          username: "admin",
          password: "1234",
          role: "admin",
        });
        localStorage.setItem("users", JSON.stringify(users));
      }
    </script>
  </body>
</html>
